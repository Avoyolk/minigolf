<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jesse's Arcade Hub</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Segoe+UI:wght@400;700&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #202020;
            font-family: 'Press Start 2P', cursive;
            touch-action: none; /* Prevents scrolling during games */
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
        }

        /* --- MENUS --- */
        #main-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #2b2b2b, #1a1a1a);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 1000;
            /* CRITICAL FIX FOR IOS: Allows taps to register on the menu */
            touch-action: manipulation; 
        }

        h1 {
            color: #f1c40f; text-shadow: 4px 4px #c0392b;
            margin-bottom: 40px; font-size: 28px; text-align: center; line-height: 1.5;
        }

        /* CHANGED: This targets BUTTONS now, not DIVs */
        .game-card {
            width: 300px; height: 100px; margin: 15px;
            border: 4px solid #fff; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.2s;
            position: relative; overflow: hidden;
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
            /* Reset Default Button Styles */
            font-family: 'Press Start 2P', cursive;
            text-decoration: none;
            appearance: none; -webkit-appearance: none;
            outline: none;
        }
        .game-card:active { transform: scale(0.96); }

        .card-golf { background: #27ae60; color: white; }
        .card-golf::before { content: '‚õ≥'; font-size: 40px; margin-right: 15px; }
        
        .card-axo { background: #ff9ff3; color: #2d3436; }
        .card-axo::before { content: 'ü¶é'; font-size: 40px; margin-right: 15px; }

        .game-title { font-size: 14px; line-height: 20px; text-align: left; pointer-events: none;}

        #back-btn {
            position: absolute; top: 10px; left: 10px; z-index: 9999;
            background: rgba(0,0,0,0.6); color: white;
            border: 2px solid white; padding: 8px 10px;
            font-family: 'Press Start 2P', cursive; font-size: 10px;
            cursor: pointer; display: none;
            touch-action: manipulation; /* Fix for back button on iOS */
        }

        /* --- WRAPPERS --- */
        #golf-wrapper, #axo-wrapper {
            display: none; width: 100%; height: 100vh; position: absolute; top: 0; left: 0;
        }

        /* --- GOLF SPECIFIC CSS --- */
        #golf-wrapper { font-family: 'Segoe UI', sans-serif; background: #222; flex-direction: column; }
        #golf-game-area { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        #golfCanvas { 
            max-width: 100%; max-height: 100%; aspect-ratio: 2/3; 
            border-radius: 12px; border: 4px solid #5d4037; background: #4cd137;
        }
        #golf-dashboard {
            height: 80px; background: #2c3e50; border-top: 4px solid #f1c40f;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; color: white;
        }
        .g-btn {
            background: #ecf0f1; border: none; border-radius: 8px;
            padding: 8px 12px; font-size: 18px; margin-left: 5px;
            cursor: pointer;
        }
        #golf-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none;
            flex-direction: column; align-items: center; justify-content: center;
            color: white; z-index: 50; text-align: center;
        }
        .water-msg { 
            color: #3498db; font-size: 24px; font-weight: bold; position: absolute; 
            top: 40%; width: 100%; text-align: center; display: none; pointer-events: none; text-shadow: 2px 2px 0 #000;
        }

        /* --- AXOLOTL SPECIFIC CSS --- */
        #axoCanvas { width: 100%; height: 100%; display: block; }
        #axo-ui {
            position: absolute; top: 60px; left: 0; width: 100%;
            text-align: center; pointer-events: none;
        }
        #axo-score { font-size: 20px; color: white; text-shadow: 2px 2px #000; }
        #axo-msg { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 14px; text-align: center; color: #ffeaa7; text-shadow: 2px 2px #000;
        }

    </style>
</head>
<body>

    <button id="back-btn" onclick="goHome()">‚¨Ö MENU</button>

    <div id="main-menu">
        <h1>JESSE'S<br>ARCADE</h1>
        <button class="game-card card-golf" onclick="startGame('GOLF')">
            <span class="game-title">MINI GOLF<br>CENTURION</span>
        </button>
        <button class="game-card card-axo" onclick="startGame('AXO')">
            <span class="game-title">AXOLOTL<br>ABYSS</span>
        </button>
    </div>

    <div id="golf-wrapper">
        <div id="golf-game-area">
            <canvas id="golfCanvas" width="600" height="900"></canvas>
            <div id="waterMsg" class="water-msg">SPLASH! +1</div>
            <div id="golf-overlay">
                <h1 id="go-title" style="color:#f1c40f; margin-bottom:10px;">HOLE IN ONE!</h1>
                <p id="go-sub" style="font-size:18px;">Strokes: 0</p>
                <button id="go-next" class="g-btn" style="background:#2ecc71; color:white; margin-top:20px;">NEXT ‚ñ∂</button>
            </div>
        </div>
        <div id="golf-dashboard">
            <div style="display:flex; flex-direction:column;">
                <div style="font-weight:bold; color:#f1c40f;">üë§ JESSE</div>
                <div id="level-display" style="font-size:12px; color:#bdc3c7;">Level 1</div>
            </div>
            <div>
                <button class="g-btn" id="rainbowToggle">üåà</button>
                <button class="g-btn" id="skipBtn">‚è≠Ô∏è</button>
                <button class="g-btn" id="resetBtn">üîÑ</button>
            </div>
        </div>
    </div>

    <div id="axo-wrapper">
        <canvas id="axoCanvas"></canvas>
        <div id="axo-ui">
            <div id="axo-score">FISH: 0</div>
            <div id="axo-msg">TAP TO SWIM</div>
        </div>
    </div>

<script>
    // === SYSTEM MANAGER ===
    let activeGame = null; 
    const menu = document.getElementById('main-menu');
    const backBtn = document.getElementById('back-btn');
    const golfWrapper = document.getElementById('golf-wrapper');
    const axoWrapper = document.getElementById('axo-wrapper');

    function startGame(game) {
        activeGame = game;
        menu.style.display = 'none';
        backBtn.style.display = 'block';

        if (game === 'GOLF') {
            golfWrapper.style.display = 'flex';
            axoWrapper.style.display = 'none';
            initGolfGame();
        } else if (game === 'AXO') {
            golfWrapper.style.display = 'none';
            axoWrapper.style.display = 'block';
            initAxoGame();
        }
    }

    function goHome() {
        activeGame = null;
        menu.style.display = 'flex';
        backBtn.style.display = 'none';
        golfWrapper.style.display = 'none';
        axoWrapper.style.display = 'none';
    }

    // ==========================================
    // GAME 1: GOLF CENTURION ENGINE
    // ==========================================
    const gCanvas = document.getElementById('golfCanvas');
    const gCtx = gCanvas.getContext('2d');
    
    // Golf State
    let gLevelIdx = 0, gStrokes = 0, gState = 'PLAYING';
    let gIsRainbow = false, gRainbowHue = 0;
    let ball = {x:300, y:800, r:16, vx:0, vy:0};
    let hole = {x:300, y:100, r:24};
    let walls=[], chickens=[], ponds=[], eggs=[], blocks67=[];
    let gDrag = {ing:false, start:{x:0,y:0}, curr:{x:0,y:0}};
    
    // Level Gen
    const gLevels = [];
    function addGLevel(bX, bY, hX, hY, w=[], c=[], p=[], b67=[]) {
        gLevels.push({ball:{x:bX,y:bY}, hole:{x:hX,y:hY}, walls:w, chickens:c, ponds:p, blocks67:b67});
    }
    // Manual Levels
    addGLevel(300,800,300,150, [{x:100,y:400,w:20,h:200},{x:480,y:400,w:20,h:200}]);
    addGLevel(300,800,300,100, [], [], [{x:300,y:450,r:60}]); // Pond
    addGLevel(300,800,300,100, [], [{x:300,y:300,r:40}], [{x:150,y:500,r:50},{x:450,y:500,r:50}]);
    addGLevel(300,800,300,100, [{x:0,y:400,w:240,h:20},{x:360,y:400,w:240,h:20}]);
    addGLevel(300,800,300,100, [], [], [], [{x:300,y:450,s:80}]); // Block 67
    
    // Auto Levels 6-100
    for(let i=5; i<100; i++) {
        let b67=[]; if(i===66) b67=[{x:200,y:400,s:60},{x:400,y:400,s:60},{x:300,y:600,s:60}];
        let w=[], p=[], c=[];
        if(i!==66) {
            for(let k=0;k<Math.floor(Math.random()*3)+1;k++) w.push(Math.random()>.5 ? {x:Math.random()*400,y:300+Math.random()*400,w:150,h:20}:{x:Math.random()*500,y:200+Math.random()*400,w:20,h:150});
            for(let k=0;k<Math.floor(Math.random()*3);k++) p.push({x:100+Math.random()*400,y:300+Math.random()*400,r:30+Math.random()*30});
            for(let k=0;k<Math.floor(Math.random()*2);k++) c.push({x:100+Math.random()*400,y:300+Math.random()*300,r:30});
        }
        addGLevel(300,800, 100+Math.random()*400, 50+Math.random()*150, w, c, p, b67);
    }

    // Golf Logic
    function initGolfGame() {
        loadGLevel(gLevelIdx);
        requestAnimationFrame(golfLoop);
    }

    function loadGLevel(idx) {
        if(idx>=gLevels.length) { idx=0; gLevelIdx=0; }
        const d = gLevels[idx];
        ball.x=d.ball.x; ball.y=d.ball.y; ball.vx=0; ball.vy=0;
        hole.x=d.hole.x; hole.y=d.hole.y;
        walls=d.walls; chickens=d.chickens.map(c=>({...c, laid:false})); ponds=d.ponds; blocks67=d.blocks67; eggs=[];
        gStrokes=0; gState='PLAYING';
        document.getElementById('level-display').innerText = `LEVEL ${idx+1}`;
        document.getElementById('golf-overlay').style.display='none';
    }

    // Golf Inputs
    function gGetPos(e) {
        const r = gCanvas.getBoundingClientRect();
        const sx = gCanvas.width/r.width; const sy = gCanvas.height/r.height;
        let cx=e.clientX, cy=e.clientY;
        if(e.touches && e.touches.length) { cx=e.touches[0].clientX; cy=e.touches[0].clientY; }
        return {x:(cx-r.left)*sx, y:(cy-r.top)*sy};
    }
    
    // Global Listeners with Safety Check
    // We keep these on window for Golf dragging, but return early if in menu
    window.addEventListener('mousedown', (e)=>{ 
        if(activeGame!=='GOLF' || gState!=='PLAYING') return; 
        gDrag.ing=true; gDrag.start=gGetPos(e); gDrag.curr=gDrag.start; 
    });
    window.addEventListener('touchstart', (e)=>{ 
        if(activeGame!=='GOLF' || gState!=='PLAYING') return; 
        gDrag.ing=true; gDrag.start=gGetPos(e); gDrag.curr=gDrag.start; 
    }, {passive:false});
    
    window.addEventListener('mousemove', (e)=>{ 
        if(!gDrag.ing) return; 
        if(e.cancelable) e.preventDefault(); 
        gDrag.curr=gGetPos(e); 
    });
    window.addEventListener('touchmove', (e)=>{ 
        if(!gDrag.ing) return; 
        if(e.cancelable) e.preventDefault(); 
        gDrag.curr=gGetPos(e); 
    }, {passive:false});
    
    window.addEventListener('mouseup', gEnd); 
    window.addEventListener('touchend', gEnd);

    function gEnd() {
        if(!gDrag.ing) return;
        gDrag.ing=false;
        let dx = gDrag.start.x - gDrag.curr.x, dy = gDrag.start.y - gDrag.curr.y;
        ball.vx = dx*0.22; ball.vy = dy*0.22;
        let s = Math.sqrt(ball.vx**2+ball.vy**2);
        if(s>35) { ball.vx*=(35/s); ball.vy*=(35/s); }
        if(s>1) gStrokes++;
    }

    // Golf UI Buttons
    document.getElementById('rainbowToggle').onclick = ()=>{gIsRainbow=!gIsRainbow;};
    document.getElementById('skipBtn').onclick = ()=>{gLevelIdx++; loadGLevel(gLevelIdx);};
    document.getElementById('resetBtn').onclick = ()=>{loadGLevel(gLevelIdx); gStrokes++;};
    document.getElementById('go-next').onclick = ()=>{gLevelIdx++; loadGLevel(gLevelIdx);};

    function golfLoop() {
        if(activeGame !== 'GOLF') return;

        // Update
        if(gState === 'PLAYING') {
            ball.x+=ball.vx; ball.y+=ball.vy;
            ball.vx*=0.97; ball.vy*=0.97;
            if(Math.abs(ball.vx)<0.1) ball.vx=0; if(Math.abs(ball.vy)<0.1) ball.vy=0;

            if(ball.x<ball.r || ball.x>600-ball.r) ball.vx*=-0.8; ball.x=Math.max(ball.r, Math.min(600-ball.r, ball.x));
            if(ball.y<ball.r || ball.y>900-ball.r) ball.vy*=-0.8; ball.y=Math.max(ball.r, Math.min(900-ball.r, ball.y));

            ponds.forEach(p => {
                if(Math.hypot(ball.x-p.x, ball.y-p.y) < p.r-5) {
                    gState='DROWNING'; 
                    document.getElementById('waterMsg').style.display='block';
                    setTimeout(()=>{ loadGLevel(gLevelIdx); document.getElementById('waterMsg').style.display='none'; }, 1500);
                }
            });

            [...walls.map(w=>({...w, t:'rect'})), ...blocks67.map(b=>({x:b.x-b.s/2, y:b.y-b.s/2, w:b.s, h:b.s, t:'rect'}))].forEach(o => {
                let cx = Math.max(o.x, Math.min(ball.x, o.x+o.w));
                let cy = Math.max(o.y, Math.min(ball.y, o.y+o.h));
                if(Math.hypot(ball.x-cx, ball.y-cy) < ball.r) {
                    if(Math.abs(ball.x-cx) > Math.abs(ball.y-cy)) ball.vx*=-1; else ball.vy*=-1;
                    ball.x += (ball.x-cx)*0.1; ball.y += (ball.y-cy)*0.1; 
                }
            });

            chickens.forEach(c => {
                if(Math.hypot(ball.x-c.x, ball.y-c.y) < c.r+ball.r) {
                    ball.vx*=-0.9; ball.vy*=-0.9;
                    if(!c.laid) { c.laid=true; eggs.push({x:c.x,y:c.y,r:12,vx:(Math.random()-.5)*5,vy:5}); }
                }
            });
            eggs.forEach(e => { e.x+=e.vx; e.y+=e.vy; e.vx*=0.9; e.vy*=0.9; });

            if(Math.hypot(ball.x-hole.x, ball.y-hole.y) < hole.r && Math.abs(ball.vx)<5) {
                gState='WON';
                document.getElementById('go-sub').innerText = `Strokes: ${gStrokes}`;
                document.getElementById('golf-overlay').style.display='flex';
            }
        }

        // Draw
        gCtx.fillStyle = '#27ae60'; gCtx.fillRect(0,0,600,900);
        
        ponds.forEach(p=>{ gCtx.fillStyle='#3498db'; gCtx.beginPath(); gCtx.arc(p.x,p.y,p.r,0,7); gCtx.fill(); });
        
        gCtx.fillStyle='#111'; gCtx.beginPath(); gCtx.arc(hole.x,hole.y,hole.r,0,7); gCtx.fill();

        gCtx.fillStyle='#8d6e63'; walls.forEach(w=>gCtx.fillRect(w.x,w.y,w.w,w.h));
        
        blocks67.forEach(b=>{
            gCtx.fillStyle='#7f8c8d'; gCtx.fillRect(b.x-b.s/2,b.y-b.s/2,b.s,b.s);
            gCtx.strokeStyle='#2c3e50'; gCtx.strokeRect(b.x-b.s/2,b.y-b.s/2,b.s,b.s);
            gCtx.fillStyle='#f1c40f'; gCtx.font='bold 30px Arial'; gCtx.textAlign='center'; gCtx.textBaseline='middle'; gCtx.fillText("67",b.x,b.y);
        });

        chickens.forEach(c=>{
            gCtx.fillStyle='#fff'; gCtx.beginPath(); gCtx.arc(c.x,c.y,c.r,0,7); gCtx.fill();
            gCtx.fillStyle='#e67e22'; gCtx.beginPath(); gCtx.arc(c.x,c.y-5,5,0,7); gCtx.fill();
        });
        eggs.forEach(e=>{ gCtx.fillStyle='#fff'; gCtx.beginPath(); gCtx.arc(e.x,e.y,e.r,0,7); gCtx.fill(); });

        if(gDrag.ing) {
            gCtx.strokeStyle='white'; gCtx.lineWidth=4; gCtx.setLineDash([10,10]);
            gCtx.beginPath(); gCtx.moveTo(ball.x,ball.y); 
            gCtx.lineTo(ball.x+(gDrag.start.x-gDrag.curr.x), ball.y+(gDrag.start.y-gDrag.curr.y)); gCtx.stroke(); gCtx.setLineDash([]);
        }

        if(gState!=='DROWNING') {
            gCtx.beginPath(); gCtx.arc(ball.x,ball.y,ball.r,0,7);
            gCtx.fillStyle = gIsRainbow ? `hsl(${(gRainbowHue+=5)%360},100%,50%)` : 'white';
            gCtx.fill(); gCtx.strokeStyle='#000'; gCtx.lineWidth=2; gCtx.stroke();
        }

        requestAnimationFrame(golfLoop);
    }

    // ==========================================
    // GAME 2: AXOLOTL ABYSS ENGINE
    // ==========================================
    const aCanvas = document.getElementById('axoCanvas');
    const aCtx = aCanvas.getContext('2d');
    
    let aFrame=0, aScore=0, aState='START', aSpeed=4;
    let axo = {x:50, y:200, dy:0};
    let aObstacles=[], aFish=[], aBubbles=[];

    function aResize() { aCanvas.width = window.innerWidth; aCanvas.height = window.innerHeight; }
    window.addEventListener('resize', aResize);
    
    function initAxoGame() {
        aResize();
        aScore=0; aFrame=0; aSpeed=4; aState='START';
        axo.y = aCanvas.height/2; axo.dy=0;
        aObstacles=[]; aFish=[]; aBubbles=[];
        document.getElementById('axo-score').innerText="FISH: 0";
        document.getElementById('axo-msg').innerHTML="TAP TO SWIM";
        requestAnimationFrame(axoLoop);
    }

    function aSwim() {
        if(activeGame !== 'AXO') return;
        if(aState==='START' || aState==='GAMEOVER') {
            if(aState==='GAMEOVER') initAxoGame();
            aState='PLAY';
            document.getElementById('axo-msg').innerText="";
            axo.dy = -7;
        } else {
            axo.dy = -7;
            for(let i=0;i<3;i++) aBubbles.push({x:axo.x,y:axo.y,r:Math.random()*4,s:Math.random()*2+1});
        }
    }
    
    // Axolotl Inputs - Listen to Window but check activeGame
    window.addEventListener('mousedown', aSwim);
    window.addEventListener('touchstart', (e)=>{
        if(activeGame !== 'AXO') return;
        e.preventDefault(); 
        aSwim();
    }, {passive:false});

    function axoLoop() {
        if(activeGame !== 'AXO') return;

        if(aState === 'PLAY') {
            axo.dy += 0.4; axo.y += axo.dy;
            
            if(aFrame%100===0) {
                let gap=200, h=Math.random()*(aCanvas.height-300)+50;
                aObstacles.push({x:aCanvas.width,y:0,w:50,h:h}); 
                aObstacles.push({x:aCanvas.width,y:h+gap,w:50,h:aCanvas.height});
            }
            if(aFrame%70===0) aFish.push({x:aCanvas.width, y:Math.random()*(aCanvas.height-100)+50, c:`hsl(${Math.random()*360},70%,50%)`, caught:false});

            aObstacles.forEach(o=>o.x-=aSpeed);
            aFish.forEach(f=>f.x-=aSpeed);
            aBubbles.forEach(b=>{b.y-=b.s; b.x-=1;});

            aObstacles = aObstacles.filter(o=>o.x+o.w>0);
            
            if(axo.y<0 || axo.y>aCanvas.height) aState='GAMEOVER';
            aObstacles.forEach(o=>{
                if(axo.x+15>o.x && axo.x-15<o.x+o.w && axo.y+10>o.y && axo.y-10<o.y+o.h) aState='GAMEOVER';
            });
            aFish.forEach(f=>{
                if(!f.caught && Math.hypot(axo.x-f.x, axo.y-f.y)<30) { f.caught=true; aScore++; document.getElementById('axo-score').innerText="FISH: "+aScore; }
            });

            if(aState==='GAMEOVER') document.getElementById('axo-msg').innerHTML=`GAME OVER<br>SCORE: ${aScore}<br>TAP TO RESTART`;
            
            aSpeed+=0.001; aFrame++;
        }

        aCtx.fillStyle = '#0984e3'; aCtx.fillRect(0,0,aCanvas.width,aCanvas.height);
        aBubbles.forEach(b=>{ aCtx.fillStyle='rgba(255,255,255,0.3)'; aCtx.beginPath(); aCtx.arc(b.x,b.y,b.r,0,7); aCtx.fill(); });
        aCtx.fillStyle='#59260b'; aObstacles.forEach(o=>{ 
            aCtx.fillRect(o.x,o.y,o.w,o.h); 
            aCtx.fillStyle='#f39c12'; aCtx.fillRect(o.x+5,o.y+5,o.w-10,5); aCtx.fillStyle='#59260b';
        });

        aFish.filter(f=>!f.caught).forEach(f=>{
            aCtx.fillStyle=f.c; aCtx.beginPath(); aCtx.arc(f.x,f.y,6,0,7); aCtx.fill();
            aCtx.beginPath(); aCtx.moveTo(f.x,f.y); aCtx.lineTo(f.x+10,f.y-5); aCtx.lineTo(f.x+10,f.y+5); aCtx.fill();
        });

        aCtx.save(); aCtx.translate(axo.x, axo.y); aCtx.rotate(axo.dy*0.1);
        aCtx.fillStyle='#ff9ff3'; aCtx.fillRect(-20,-12,40,24); 
        aCtx.fillStyle='#fd79a8'; aCtx.fillRect(-10,-18,5,6); aCtx.fillRect(0,-18,5,6); 
        aCtx.fillRect(-10,12,5,6); aCtx.fillRect(0,12,5,6); 
        aCtx.fillStyle='black'; aCtx.fillRect(10,-8,4,4); aCtx.fillRect(10,4,4,4); 
        aCtx.restore();

        requestAnimationFrame(axoLoop);
    }
</script>
</body>
</html>
